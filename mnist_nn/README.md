
# MNIST Neural Network

This is a baseline code for the course project of EE2003 at IIT Madras.

*Note*: This is a forked repository of PicoRV32 (given below)

Acknowledgements:
- [PicoRV32](https://github.com/YosysHQ/picorv32) - from C. Wolf (YosysHQ).  

## Problem statement

This is a project based on inference of neural networks on MNIST images. The baseline code written in C, is available at `firmware/hello.c` and it can be run under the constrained environment of the picorv processor.

This means that there isn't access to things like File Input/Output, memory management (`malloc` etc.) or `printf` style statements that can be usually used for debugging.

To get around these the code has the following additions:

- A set of addresses starting from WBDBASE (`0x30000000`) are defined for reading from the file. The pre-processing script (`temp_c_files/nn.c`) is used to generate the file `firmware/wbd.hex` which will be mapped to this memory range.  This is marked as a read-only memory.
- A set of addresses starting at `0x40000000` are defined for use with the memory management.

## How to run

### Step 1 - Generate a suitable input
The code comes with weights, biases and input image in `firmware/wbd.hex` - this corresponds to the weights, biases and input image files in `temp_c_files`.  The hex file can be generated by executing the code `nn.c` in `temp_c_files`. 

### Step 2.1 - Build and run with iverilog

```sh
$ make
```
Just typing the above command (while you are in the `mnits_nn` folder, not inside one of the subfolders) will take care of compiling and running with iverilog.

**WARNING**: This is *horrendously* slow - it takes about 4-5 *minutes* to run on the default input image, which is just a single 28 x 28 MNIST image.  

### Step 2.2 - Build and run with verilator
Fortunately, there is a *much* faster verilog simulator called `verilator`.  This works by first converting the Verilog code into C++, compiling it, and running the resulting executable.  This can actually finish simulation in less than 10 seconds.  If you want to test any changes to your code, you are strongly advised to use this approach.

To run this, you can just type 
```sh
$ make test_verilator
```

### Step 3 - understand the results
When you run the code, it prints out the scores for each class on the terminal. The true value of results can be obtained by running make, can be compared to the ones obtained by executing `temp_c_files/nn.c` to verify the correctnes, and nn.c was veriified with a Tensorflow code. 
